# Phase 5 å‰ç«¯å¼€å‘è¿›åº¦æŠ¥å‘Š

> æµåŠ¨æ€§æŒ–çŸ¿å‰ç«¯å¼€å‘è¿›è¡Œä¸­...

---

## ğŸ“… æœ€åæ›´æ–°

**2025-11-01**

---

## âœ… å·²å®Œæˆå†…å®¹

### 1. åˆçº¦ ABI æ–‡ä»¶

**æ–‡ä»¶**ï¼š
- `src/contracts/MasterChef.json` âœ…
- `src/contracts/DEXToken.json` âœ…

**åŒ…å«çš„å‡½æ•°**ï¼š
- MasterChef: deposit, withdraw, emergencyWithdraw, poolInfo, userInfo, pendingReward, poolLength, rewardPerBlock, totalAllocPoint, getPoolAPR
- DEXToken: æ ‡å‡† ERC20 å‡½æ•°

---

### 2. API Service æ‰©å±•

**æ–‡ä»¶**ï¼š`src/services/api.ts`

**æ–°å¢æ–¹æ³•**ï¼š
```typescript
âœ… getAllFarms()            // è·å–æ‰€æœ‰æŒ–çŸ¿æ± 
âœ… getFarm(poolId)          // è·å–å•ä¸ªæ± å­
âœ… syncFarm(poolId)         // æ‰‹åŠ¨åŒæ­¥
âœ… getUserFarms(address)    // è·å–ç”¨æˆ·è´¨æŠ¼
âœ… getFarmingLeaderboard()  // è·å–æ’è¡Œæ¦œ
```

---

### 3. useFarming Hook

**æ–‡ä»¶**ï¼š`src/hooks/useFarming.ts`

**å¯¼å‡ºçš„ Hooks**ï¼š

#### useFarmingï¼ˆå†™æ“ä½œï¼‰
```typescript
âœ… approveLPToken()         // æˆæƒ LP Token
âœ… deposit()                // è´¨æŠ¼
âœ… withdraw()               // æå–ï¼ˆè‡ªåŠ¨é¢†å–å¥–åŠ±ï¼‰
âœ… emergencyWithdraw()      // ç´§æ€¥æå–
```

#### useReadFarmingï¼ˆè¯»æ“ä½œï¼‰
```typescript
âœ… poolInfo                 // æ± å­ä¿¡æ¯
âœ… userInfo                 // ç”¨æˆ·ä¿¡æ¯
âœ… pendingReward            // å¾…é¢†å–å¥–åŠ±
âœ… lpBalance                // LP Token ä½™é¢
âœ… allowance                // æˆæƒé¢åº¦
```

#### useReadGlobalFarmingï¼ˆå…¨å±€æ•°æ®ï¼‰
```typescript
âœ… poolLength               // æ± å­æ•°é‡
âœ… rewardPerBlock           // æ¯åŒºå—å¥–åŠ±
âœ… totalAllocPoint          // æ€»åˆ†é…ç‚¹
```

---

### 4. FarmCard ç»„ä»¶

**æ–‡ä»¶**ï¼š
- `src/components/FarmCard/index.tsx` âœ…
- `src/components/FarmCard/index.css` âœ…

**åŠŸèƒ½**ï¼š
- æ˜¾ç¤º LP Token ä¿¡æ¯ï¼ˆToken0-Token1ï¼‰
- æ˜¾ç¤º APRï¼ˆå¸¦é¢œè‰²ç¼–ç ï¼‰
- æ˜¾ç¤º TVL å’Œæ¯æ—¥å¥–åŠ±
- æ˜¾ç¤ºç”¨æˆ·è´¨æŠ¼ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
- ç‚¹å‡»è·³è½¬åˆ°è¯¦æƒ…é¡µ

**ç‰¹ç‚¹**ï¼š
- å“åº”å¼è®¾è®¡
- Hover åŠ¨ç”»æ•ˆæœ
- Token å›¾æ ‡é‡å æ•ˆæœ

---

### 5. Farms é¡µé¢ï¼ˆæŒ–çŸ¿æ± åˆ—è¡¨ï¼‰

**æ–‡ä»¶**ï¼š
- `src/pages/Farms/index.tsx` âœ…
- `src/pages/Farms/index.css` âœ…

**åŠŸèƒ½**ï¼š
- æ˜¾ç¤ºæ‰€æœ‰æŒ–çŸ¿æ± åˆ—è¡¨
- æ¦‚è§ˆç»Ÿè®¡ï¼ˆæ€» TVLã€æ´»è·ƒæ± å­ã€æ¯åŒºå—å¥–åŠ±ã€DEX ä»·æ ¼ï¼‰
- æœç´¢åŠŸèƒ½ï¼ˆæŒ‰ Token ç¬¦å·ï¼‰
- æ’åºåŠŸèƒ½ï¼ˆAPRã€TVLã€æˆ‘çš„è´¨æŠ¼ï¼‰
- æ˜¾ç¤ºç”¨æˆ·è´¨æŠ¼ä¿¡æ¯ï¼ˆå¦‚æœå·²è¿æ¥é’±åŒ…ï¼‰
- ä½¿ç”¨è¯´æ˜

**ç‰¹ç‚¹**ï¼š
- ç½‘æ ¼å¸ƒå±€ï¼ˆå“åº”å¼ï¼‰
- å®æ—¶æ•°æ®åŠ è½½
- ç”¨æˆ·æ•°æ®å åŠ æ˜¾ç¤º

---

## ğŸ”„ å¾…å®Œæˆå†…å®¹

### 6. Farm è¯¦æƒ…é¡µï¼ˆ/farms/:poolIdï¼‰â³

**éœ€è¦å®ç°**ï¼š
- æ± å­è¯¦ç»†ä¿¡æ¯
- APR å†å²å›¾è¡¨
- è´¨æŠ¼æ“ä½œç•Œé¢
  - è¾“å…¥è´¨æŠ¼æ•°é‡
  - æˆæƒæŒ‰é’®
  - è´¨æŠ¼æŒ‰é’®
- æå–æ“ä½œç•Œé¢
  - è¾“å…¥æå–æ•°é‡
  - æå–æŒ‰é’®
- æ˜¾ç¤ºå¾…é¢†å–å¥–åŠ±
- ç´§æ€¥æå–æŒ‰é’®

### 7. My Farms é¡µé¢ï¼ˆ/farms/meï¼‰â³

**éœ€è¦å®ç°**ï¼š
- ç”¨æˆ·è´¨æŠ¼æ€»è§ˆ
- æ‰€æœ‰è´¨æŠ¼æ± å­åˆ—è¡¨
- æ€»æ”¶ç›Šç»Ÿè®¡
- æ‰¹é‡é¢†å–å¥–åŠ±æŒ‰é’®

### 8. WebSocket å®æ—¶æ›´æ–° â³

**éœ€è¦å®ç°**ï¼š
- ç›‘å¬ `farming:action` äº‹ä»¶
- å®æ—¶æ›´æ–°æ± å­æ•°æ®
- å®æ—¶æ›´æ–°ç”¨æˆ·æ•°æ®
- Toast é€šçŸ¥ï¼ˆè´¨æŠ¼/æå–æˆåŠŸï¼‰

### 9. è·¯ç”±é…ç½® â³

**éœ€è¦æ·»åŠ **ï¼š
```typescript
{
  path: '/farms',
  element: <Farms />
},
{
  path: '/farms/:poolId',
  element: <FarmDetail />
},
{
  path: '/farms/me',
  element: <MyFarms />
}
```

### 10. å¯¼èˆªèœå• â³

**éœ€è¦æ·»åŠ **ï¼š
- åœ¨ä¸»å¯¼èˆªä¸­æ·»åŠ "æŒ–çŸ¿"é“¾æ¥

---

## ğŸ“Š å½“å‰è¿›åº¦

**å‰ç«¯å¼€å‘è¿›åº¦ï¼š60%**

| ä»»åŠ¡ | çŠ¶æ€ | è¿›åº¦ |
|------|------|------|
| åˆçº¦ ABI | âœ… å®Œæˆ | 100% |
| API Service | âœ… å®Œæˆ | 100% |
| useFarming Hook | âœ… å®Œæˆ | 100% |
| FarmCard ç»„ä»¶ | âœ… å®Œæˆ | 100% |
| Farms é¡µé¢ | âœ… å®Œæˆ | 100% |
| Farm è¯¦æƒ…é¡µ | â³ å¾…å®Œæˆ | 0% |
| My Farms é¡µé¢ | â³ å¾…å®Œæˆ | 0% |
| WebSocket é›†æˆ | â³ å¾…å®Œæˆ | 0% |
| è·¯ç”±é…ç½® | â³ å¾…å®Œæˆ | 0% |

---

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### 1. çŠ¶æ€ç®¡ç†
- ä½¿ç”¨ React useState ç®¡ç†æœ¬åœ°çŠ¶æ€
- ä½¿ç”¨ wagmi useAccount è·å–é’±åŒ…ä¿¡æ¯
- ä½¿ç”¨ useReadContract è¯»å–é“¾ä¸Šæ•°æ®

### 2. æ•°æ®æµ
```
é“¾ä¸Šæ•°æ® (MasterChef) 
    â†“
useReadFarming Hook
    â†“
å‰ç«¯ç»„ä»¶

åç«¯æ•°æ® (API)
    â†“
apiService
    â†“
å‰ç«¯ç»„ä»¶
```

### 3. äº¤äº’æµç¨‹

**è´¨æŠ¼æµç¨‹**ï¼š
1. ç”¨æˆ·è¾“å…¥è´¨æŠ¼æ•°é‡
2. æ£€æŸ¥æˆæƒé¢åº¦
3. å¦‚æœéœ€è¦ï¼Œå…ˆæˆæƒ LP Token
4. è°ƒç”¨ deposit å‡½æ•°
5. ç­‰å¾…äº¤æ˜“ç¡®è®¤
6. æ›´æ–° UI

**æå–æµç¨‹**ï¼š
1. ç”¨æˆ·è¾“å…¥æå–æ•°é‡
2. è°ƒç”¨ withdraw å‡½æ•°ï¼ˆè‡ªåŠ¨é¢†å–å¥–åŠ±ï¼‰
3. ç­‰å¾…äº¤æ˜“ç¡®è®¤
4. æ›´æ–° UI

---

## ğŸ¨ UI/UX ç‰¹ç‚¹

### 1. FarmCard è®¾è®¡
- **Token å›¾æ ‡é‡å **ï¼šè§†è§‰ä¸Šè¡¨ç¤ºäº¤æ˜“å¯¹
- **APR é¢œè‰²ç¼–ç **ï¼š
  - >= 100%ï¼šç»¿è‰²ï¼ˆé«˜æ”¶ç›Šï¼‰
  - >= 50%ï¼šè“è‰²ï¼ˆä¸­ç­‰æ”¶ç›Šï¼‰
  - < 50%ï¼šé»„è‰²ï¼ˆä½æ”¶ç›Šï¼‰
- **ç”¨æˆ·æ•°æ®é«˜äº®**ï¼šå·²è´¨æŠ¼çš„æ± å­æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯

### 2. Farms é¡µé¢
- **æ¦‚è§ˆç»Ÿè®¡**ï¼šä¸€ç›®äº†ç„¶çš„å…¨å±€æ•°æ®
- **æœç´¢å’Œæ’åº**ï¼šæ–¹ä¾¿ç”¨æˆ·æ‰¾åˆ°ç›®æ ‡æ± å­
- **å“åº”å¼å¸ƒå±€**ï¼šé€‚é…ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯

### 3. äº¤äº’åé¦ˆ
- Loading çŠ¶æ€ï¼ˆéª¨æ¶å±æˆ– Spinï¼‰
- Toast æ¶ˆæ¯ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰
- æŒ‰é’®çŠ¶æ€ï¼ˆåŠ è½½ä¸­/ç¦ç”¨ï¼‰

---

## ğŸ“ ä»£ç è§„èŒƒ

### 1. ç»„ä»¶ç»“æ„
```typescript
// å¯¼å…¥
import React from 'react'
import { Component } from 'antd'

// ç±»å‹å®šä¹‰
interface Props {
  // ...
}

// ç»„ä»¶
const MyComponent: React.FC<Props> = (props) => {
  // Hooks
  // çŠ¶æ€
  // å‰¯ä½œç”¨
  // å¤„ç†å‡½æ•°
  // æ¸²æŸ“
}

export default MyComponent
```

### 2. å‘½åè§„èŒƒ
- ç»„ä»¶ï¼šPascalCaseï¼ˆFarmCardï¼‰
- å‡½æ•°ï¼šcamelCaseï¼ˆloadFarmsï¼‰
- å¸¸é‡ï¼šUPPER_SNAKE_CASEï¼ˆMASTER_CHEF_ADDRESSï¼‰
- æ–‡ä»¶ï¼škebab-case æˆ– PascalCase

### 3. CSS è§„èŒƒ
- BEM å‘½åï¼š`.farm-card__header`
- å“åº”å¼ï¼šMobile First
- å˜é‡ï¼šä½¿ç”¨ CSS å˜é‡æˆ–ä¸»é¢˜

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### ç«‹å³å¼€å§‹ï¼š

1. **å®Œæˆ Farm è¯¦æƒ…é¡µ**
   - åˆ›å»º `/pages/FarmDetail/index.tsx`
   - å®ç°è´¨æŠ¼/æå–æ“ä½œç•Œé¢
   - é›†æˆ useFarming Hook

2. **å®Œæˆ My Farms é¡µé¢**
   - åˆ›å»º `/pages/MyFarms/index.tsx`
   - æ˜¾ç¤ºç”¨æˆ·æ‰€æœ‰è´¨æŠ¼
   - å®ç°æ‰¹é‡æ“ä½œ

3. **é›†æˆ WebSocket**
   - åˆ›å»º `useFarmingWebSocket` Hook
   - ç›‘å¬å®æ—¶äº‹ä»¶
   - è‡ªåŠ¨æ›´æ–° UI

4. **é…ç½®è·¯ç”±**
   - æ›´æ–° `App.tsx` æˆ–è·¯ç”±é…ç½®æ–‡ä»¶
   - æ·»åŠ å¯¼èˆªé“¾æ¥

5. **æµ‹è¯•**
   - ç«¯åˆ°ç«¯æµ‹è¯•
   - ç”¨æˆ·ä½“éªŒä¼˜åŒ–

---

## ğŸ“¦ æ–‡ä»¶æ¸…å•

### å·²åˆ›å»ºæ–‡ä»¶ï¼ˆ8 ä¸ªï¼‰ï¼š

```
frontend/web-app/src/
â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ MasterChef.json                    âœ…
â”‚   â””â”€â”€ DEXToken.json                      âœ…
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useFarming.ts                      âœ…
â”œâ”€â”€ services/
â”‚   â””â”€â”€ api.ts (å·²æ›´æ–°)                    âœ…
â”œâ”€â”€ components/
â”‚   â””â”€â”€ FarmCard/
â”‚       â”œâ”€â”€ index.tsx                      âœ…
â”‚       â””â”€â”€ index.css                      âœ…
â””â”€â”€ pages/
    â””â”€â”€ Farms/
        â”œâ”€â”€ index.tsx                      âœ…
        â””â”€â”€ index.css                      âœ…
```

### å¾…åˆ›å»ºæ–‡ä»¶ï¼ˆ3+ ä¸ªï¼‰ï¼š

```
frontend/web-app/src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ FarmDetail/
â”‚   â”‚   â”œâ”€â”€ index.tsx                      â³
â”‚   â”‚   â””â”€â”€ index.css                      â³
â”‚   â””â”€â”€ MyFarms/
â”‚       â”œâ”€â”€ index.tsx                      â³
â”‚       â””â”€â”€ index.css                      â³
â””â”€â”€ hooks/
    â””â”€â”€ useFarmingWebSocket.ts (å¯é€‰)     â³
```

---

## ğŸ¯ è´¨é‡æ£€æŸ¥æ¸…å•

### åŠŸèƒ½æ€§
- [ ] æ‰€æœ‰ API è°ƒç”¨æ­£å¸¸
- [ ] åˆçº¦äº¤äº’æ­£å¸¸ï¼ˆè´¨æŠ¼/æå–ï¼‰
- [ ] æ•°æ®æ˜¾ç¤ºå‡†ç¡®
- [ ] å®æ—¶æ›´æ–°å·¥ä½œæ­£å¸¸

### ç”¨æˆ·ä½“éªŒ
- [ ] åŠ è½½çŠ¶æ€æ¸…æ™°
- [ ] é”™è¯¯æç¤ºå‹å¥½
- [ ] å“åº”å¼è®¾è®¡
- [ ] äº¤äº’æµç•…

### ä»£ç è´¨é‡
- [ ] æ—  TypeScript é”™è¯¯
- [ ] æ—  ESLint è­¦å‘Š
- [ ] ä»£ç æ ¼å¼ç»Ÿä¸€
- [ ] æ³¨é‡Šå®Œæ•´

---

**å½“å‰çŠ¶æ€**ï¼šæ ¸å¿ƒåŠŸèƒ½å·²å®ç° âœ…ï¼Œå‰©ä½™é¡µé¢å¼€å‘ä¸­ â³

